---
title: "Final Report"
author: "Tong Wu"
date: "4/30/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo = F, message = F, warning = F, results='hide'}
library(RSQLite)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lme4)
library(car)
library(tidyverse)
library(broom)
```

```{r}
modeldata <- read.csv("modeldata.csv")
```

```{r}
modeldata <- modeldata %>%
  filter(party_age %in% c(16:100)) %>%
  mutate(party_race = as.factor(party_race)) %>%
  mutate(vehicle_type_sort = as.factor(vehicle_type_sort))
modeldata$party_race <- relevel(modeldata$party_race, ref="white")
modeldata$vehicle_type_sort <- relevel(modeldata$vehicle_type_sort, ref="other")
```

```{r}
modeldata <- modeldata %>%
  filter(carnation != "OTHER")
```

```{r}
modeldata <- modeldata %>%
  mutate(alcohol_involvedstatus = case_when(
    alcohol_involved == 0 ~ "no",
    alcohol_involved == 1 ~ "yes"
  ))
```

# 1. Introduction

## 1.1 Background

Alcohol-related car accidents are a major problem in the United States. In 2016, 10,497 people died of alcohol-related car accidents and accounted for 28% of all traffic-related deaths. Extensive studies have investigated how the odds of alcohol-related vehicular crashes are associated with factors such as race, age, car types, and socioeconomic status. Younger drivers are associated with an increase in risk of alcohol-related accidents in both sexes [1]. Alcohol-related accidents are also more common among male drivers than female drivers. [2] Latino drivers have consistently had a higher prevalence of being involved in drunk driving crashes. RAM 2500, Chevy S-10, and BMW 4-series were found to have the most DUIs according to data from Insurance company Insurify. [3] Furthermore, lower socioeconomic status was associated with increased risks of drunk driving. [4] However, there hasn’t been a definitive study that, to our knowledge, accounted for all of these factors, along with other factors such as weather and road conditions, specifically in alcohol-impaired motor crashes. 

The aim of our study is to determine significant factors that are associated with an increase in the probability of alcohol-related car accidents in California through constructing a statistical model. We are interested in the following questions:

1. Are certain car characteristics, such as the model year, car type, nationality of the car brand, whether the car is a premium brand or classified as a sports car, associated with increased odds of alcohol-related accidents?

2. Are demographic factors such as race, sex, and age significantly associated with the probability of alcohol-related accidents?

3. Is insurance status associated with lower risks of drunk-driving accidents, and how does this association vary by race, sex, age, and whether a driver has a premium car or a sports car?

We want to examine these factors while also controlling for weather conditions, crash types, and county population. We hope that our analysis will provide helpful insights for insurance companies and policymakers to develop solutions to combat alcohol-related car accidents.

## 1.2 Data Information

The dataset we used was from the California Traffic Collision Data from Statewide Integrated Traffic Records System (SWITRS). We only focused on automobile accidents that took place in 2020, which totaled 2,741,357 events. The dataset contains various information about each accident, including characteristics of the driver, insurance status, car involved, whether alcohol was involved, county in which the crash took place, as well as the weather and road conditions during the crash. We decided to focus only on crash events where the driver was at fault, because we were interested in understanding what factors about the driver are associated with increased rates of alcohol-related car accidents. Since all the observations only occurred in the state of California, the insights we gain from our analysis will not be generalizable to areas of the US with very different traffic laws, weather conditions, and economy/weath. 

## 1.3 Exploratory Data Analysis

Our response, or dependent variable, is a binary variable of whether the accident was alcohol-related or not. 

To get a better understanding of vehicle characteristics associated with drunk driving crashes for the first question, we examined the vehicle’s model year, type, nationality of the vehicle brand, whether the vehicle was premium, and whether the vehicle was classified as a sports car. The nationality of the vehicle brand was grouped into American, Asian, and European. Cars classified as premium included brands such as Mercedes, Lexus, and Audi. Cars classified as sports cars included brands such as Ferrari, Lamborghini, and Aston Martin. Vehicle type was simplified from the original dataset by classifying vehicles as only passenger cars, trucks, two-wheeled vehicles such as motorcycles, buses, and other vehicle types.

To examine demographic characteristics about the driver for the second question, we examined the age, race, and sex of the drivers at fault in the crash and determined whether certain characteristics are significantly associated with higher rates of alcohol-related accidents. 

For the third question, we examined whether the driver is insured or not, and determined whether it is significantly associated with drunk crashes. In addition, we are interested in determining if significant two-interactions exist between insurance status and race, sex, age, and premium car status because insurance coverage rates could vary by these factors. 

Finally, we also controlled for environmental factors, such as weather and road surface conditions, that can affect general car crash rates in our model. In addition, we also controlled for county population because it is reasonable to assume that higher density counties will have more accidents and thus more alcohol-related vehicle crashes. 

## 1.3 Exploratory Data Analysis

To visualize how the rate of alcohol related accidents varies across the variables of interest, we generated stacked bar plots. Below are plots:

```{r}
modeldata %>%
  select(alcohol_involvedstatus, vehicle_type_sort) %>%
  mutate(alcohol_involved=as.factor(alcohol_involvedstatus)) %>%
  ggplot(aes(x= vehicle_type_sort, fill=alcohol_involved)) +
  geom_bar(position="fill")+labs(y="Proportions", title="Vehicle Type vs Alcohol-related accident", x="Vehicle Type ", subtitle="Passenger cars, trucks, and Two-wheel vehicles have higher rates of Drunk-driving crashes") + 
  theme(axis.text.x= element_text(size=8, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=10),
        legend.title=element_text(size=10)) +
  guides(fill=guide_legend(title="Alcohol Related or Not"))
```

```{r}
modeldata %>%
  select(alcohol_involvedstatus, party_sex) %>%
  mutate(alcohol_involved=as.factor(alcohol_involvedstatus)) %>%
  ggplot(aes(x= party_sex, fill=alcohol_involved)) +
  geom_bar(position="fill")+labs(y="Proportions", title="Sex vs Alcohol-related accident", x="Sex", subtitle="Male drivers have higher rates of alcohol related accidents.") + 
  theme(axis.text.x= element_text(size=8, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=10),
        legend.title=element_text(size=10)) +
  guides(fill=guide_legend(title="Alcohol Related or Not"))
```

```{r}
modeldata %>%
  select(alcohol_involvedstatus, party_race) %>%
  mutate(alcohol_involved=as.factor(alcohol_involvedstatus)) %>%
  ggplot(aes(x= party_race, fill=alcohol_involved)) +
  geom_bar(position="fill")+labs(y="Proportions", title="Race vs Alcohol-related accident", x="Race", subtitle="Hispanics have the highest rate of alcohol-related accidents compared to that of other races.") + 
  theme(axis.text.x= element_text(size=8, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=10),
        legend.title=element_text(size=10)) +
  guides(fill=guide_legend(title="Alcohol Related or Not"))
```

```{r}
modeldata %>%
  select(alcohol_involvedstatus, financial_responsibility) %>%
  mutate(alcohol_involved=as.factor(alcohol_involvedstatus)) %>%
  ggplot(aes(x= financial_responsibility, fill=alcohol_involvedstatus)) +
  geom_bar(position="fill")+labs(y="Proportions", title="Insurance Status vs Alcohol-related accident", x="Insurance Status", subtitle="Insured drivers had lower rates of drunk driving accidents.") + 
  theme(axis.text.x= element_text(size=8, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=10),
        legend.title=element_text(size=10)) +
  guides(fill=guide_legend(title="Alcohol Related or Not"))
```

```{r}
modeldata <- modeldata %>%
  mutate(alcohol_involvedstatus=as.factor(alcohol_involvedstatus))
ggplot(modeldata, aes_string(x= modeldata$party_age, fill=modeldata$alcohol_involvedstatus)) +
  geom_density(position="fill")+labs(y="Proportions", title="Age vs Alcohol-related Accidents", x="Age (years)", subtitle="Drunk Crash rates generally decreases with age until around 90") + 
  theme(axis.text.x= element_text(size=7, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=7),
        legend.title=element_text(size=6)) +
  guides(fill=guide_legend(title="Alcohol-related or no")) + xlim(c(16,100))
```

```{r}
modeldata %>%
  select(alcohol_involvedstatus, premiumcar) %>%
  mutate(alcohol_involved=as.factor(alcohol_involvedstatus)) %>%
  ggplot(aes(x= premiumcar,fill=alcohol_involved)) +
  geom_bar(position="fill")+labs(y="Proportions", title="Premium Car Status vs Alcohol-related accident", x="Premium Car Status", subtitle="Drunk crash rates are similar between premium and non-premium cars.") + 
  theme(axis.text.x= element_text(size=8, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=10),
        legend.title=element_text(size=10)) +
  guides(fill=guide_legend(title="Alcohol Related or Not")) 
```

```{r}
modeldata %>%
  select(alcohol_involvedstatus, sportcar) %>%
  mutate(alcohol_involved=as.factor(alcohol_involvedstatus)) %>%
  ggplot(aes(x= sportcar, fill=alcohol_involved)) +
  geom_bar(position="fill")+labs(y="Proportions", title="Sports Car Status vs Alcohol-related accident", x="Sports Car Status", subtitle="Drunk crash rates are slightly higher in sports cars than non-sports cars.") + 
  theme(axis.text.x= element_text(size=8, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=10),
        legend.title=element_text(size=10)) +
  guides(fill=guide_legend(title="Alcohol Related or Not"))
```

```{r}
modeldata %>%
  select(alcohol_involvedstatus, carnation) %>%
  mutate(alcohol_involved=as.factor(alcohol_involvedstatus)) %>%
  ggplot(aes(x= carnation, fill=alcohol_involved)) +
  geom_bar(position="fill")+labs(y="Proportions", title="Car brand nationality vs Alcohol-related accident", x="Car Brand Nationality", subtitle="Drunk crash rates are similar across car brand nationalities.") + 
  theme(axis.text.x= element_text(size=8, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=10),
        legend.title=element_text(size=10)) +
  guides(fill=guide_legend(title="Alcohol Related or Not"))
```

```{r}
ggplot(modeldata, aes_string(x= modeldata$vehicle_year, fill=modeldata$alcohol_involvedstatus)) +
  geom_density(position="fill")+labs(y="Proportions", title="Newer cars have slightly lower drunk crash rates than older cars.", x="Model year") + 
  theme(axis.text.x= element_text(size=7, angle=0, vjust=0.5, hjust=.5), 
        plot.title=element_text(size=9),
        plot.subtitle=element_text(size=9, color="red"),
        legend.text=element_text(size=7),
        legend.title=element_text(size=6)) +
  guides(fill=guide_legend(title="Alcohol-related or no")) + xlim(c(1900,2020))
```

# 2. Methodology
## 2.1 Model Selection

Our goal was to develop an interpretable model that incorporated all the demographic, vehicle, and weather factors that we were interested in to determine which factors are significantly associated with higher/lower probability of alcohol-related car accidents in the context of all the predictors. Given these considerations, we decided that logistic regression was the best choice for our model. It provides interpretable coefficients that can help us determine which factors are significantly associated with an increase or decrease in probability of drunk automobile crashes. Furthermore, since our response variable is a binary variable indicating whether a car crash was alcohol-related or not, the logit-link from the logistic model is the most appropriate. A linear regression model, while also interpretable, would not allow our response variable to be bound between 0 and 1, which is inappropriate for analyzing our probability of interest.

## 2.2 Model Formulation

We propose the following generalized linear model (GLM) below:

$$
\begin{aligned}
\text{logit}(\mu_i) =& \beta_0 + \beta_1DriverAge_{i} + \beta_2I(VehicleType_{i}) + \beta_3I(Race_{i}) \\&+ \beta_4I(Sex_{i} = Male) + \beta_5I(PremiumCar_{i} = Yes) \\&+ \beta_6I(Insurance_{i} = Yes) + \beta_7I(WeatherCondition_{i}) 
\\&+ \beta_8I(CollisionType_{i}) + \beta_{9}(CountyPopulation_{j}) + \beta_{10}I(SportsCar_{i} = Yes)
\\&+ \beta_{11}I(Insurance_{i} = Yes)*I(Race_{i})
\\&+ \beta_{12}I(Insurance_{i} = Yes)*I(Sex_{i} = Male)
\\&+ \beta_{13}I(Insurance_{i} = Yes)*DriverAge_{i}
\\&+ \beta_{14}I(Insurance_{i} = Yes)*I(PremiumCar_{i} = Yes)
\\&+ \beta_{15}I(Insurance_{i} = Yes)*I(SportsCar_{i} = Yes)
\\&+ \beta_{16}*(VehicleModelYear_{i}) 
\\&+ \epsilon_{i}
\\ 
\mu_i \sim Ber(\mu),
\\
\epsilon_{ij} \sim N(0, \sigma^2)
\end{aligned}
$$

From our model shown above, $i$ represents each crash event, $j$ represents the index for the county where the crash event took place, and $\mu_{i}$ is the probability of the crash event being alcohol-related. The levels for vehicle type are: passenger car, truck, two-wheel vehicles, bus, and other vehicle types (baseline). The levels for race are: White (baseline), Black, Asian, Hispanic, and Other. The levels for Car Nationality are: Asian, European, and American (baseline). The levels for Weather Conditions are: Clear (baseline), cloudy, foggy, other, raining, snowing, and wind. The levels for Collision Type are: Broadside (Baseline), Head-on, hit object, other, overturned, pedestrian, rear end, and sideswipe.

## 2.3 Diagnostics and Assumptions Check for Model

The independence of observations assumption was met because every observation comes from one crash event. We checked for constant variance and lack of pattern in model residuals vs. fitted values by graphing a binned residual plot. To check for lack of multicollinearity, we calculated the variable inflation factor (VIF) values for all predictors in our initial model and made sure the VIF values are all less than 10. We also used drop-in deviance tests to assess whether categorical predictors and interaction effects in our model were significant. Regardless of whether these predictors and interactions were significant or not, they were incorporated in our model for the reasons mentioned in the Variable of Interest section. 

## 2.4 Sensitivity Analysis

We initially wanted to account for systematic variations that might exist at the county level in our model. Our rationale was that without controlling for county-level effects, the independence assumption might be violated because certain county-level characteristics that we do not have data on could contribute to variations in the rate of alcohol-related crashes. This variation could lead to different alcohol-related crashes based on location rather than the other factors we are interested in. To account for this, we added a county-level random effect to generate a mixed effects model. However, after generating the model, we observed the intraclass correlation coefficient (ICC) to be only 0.03. This value was very low and indicated that only 3% of the total variance in the probability of alcohol-related crashes was accounted for by county-level clustering. This means that the systematic variations at the county level were not very prominent in our model. Thus, we decided not to incorporate it and proceeded with regular logistic regression. Results for the mixed model can be found in the appendix. 

# 3. Results

| Termin | Estimate | p-value |
|Intercept | -2.632 | <0.001 |
| Sex: Male | 0.578 | <0.001 |
| Insurance: Yes | -0.704 | <0.001 |
| Driver Age | 0.005 | <0.001 |
| Race: Asian | -0.286 | <0.001 |
| Race: Black | -0.388 | <0.001 |
| Race: Hispanic | 0.160 | <0.01 |
| Race: Other | -0.297 | <0.001 |
| Vehicle Model Year | -0.000 | 0.841 |
| Vehicle Type: Bus | -0.150 | 0.156 |
| Vehicle Type: Passenger Car | 0.593 | <0.001 |
| Vehicle Type: Truck | 0.463 | <0.001 |
| Vehicle Type: Two Wheel | -0.253 | 0.008 |
| Premium Car: Yes | -0.020 | 0.129 |
| Car Nationality: Asian | 0.007 | 0.121 |
| Car Nationality: European | 0.094 | <0.001 |
| Sports Car: Yes | 0.383 | 0.002 |
| County Population | -0.014 | <0.001 |
| Weather Condition: Cloudy | -0.294 | <0.001 |
| Weather Condition: Foggy | 0.076 | 0.008 |
| Weather Condition: Other | -0.233 | 0.003 |
| Weather Condition: Raining | -0.288 | <0.001 |
| Weather Condition: Snowing | -1.260 | <0.001 |
| Weather Condition: Windy | 0.087 | 0.438 |
| Collision Type: Head-On | 1.062 | <0.001 |
| Collision Type: Hit Object | 1.544 | <0.001 |
| Collision Type: Other | 0.500 | <0.001 |
| Collision Type: Overturned | 1.222 | <0.001 |
| Collision Type: Pedestrian | 0.2705 | <0.001 |
| Collision Type: Rear-End | 0.253 | <0.001 |
| Collision Type: Side-swipe | 0.765 | <0.001 |
| Insurance:Yes*Sex: Male | 0.007 | 0.522 |
| Insurance:Yes*Driver Age | -0.013 | <0.001 |
| Insurance:Yes*Race: Asian | -0.346 | <0.001 |
| Insurance:Yes*Race: Black | 0.261 | <0.001 |
| Insurance:Yes*Race: Hispanic | 0.003 | 0.787 |
| Insurance:Yes*Race: Other | -0.317 | <0.001 |
| Insurance:Yes*Premium Car: Yes | 0.135 | <0.001 |
| Insurance:Yes*Sports Car: Yes | -0.209 | 0.118 |



```{r}
model4 <- glm(data=modeldata, alcohol_involved ~ party_sex * financial_responsibility + party_age * financial_responsibility + party_race * financial_responsibility + vehicle_year + vehicle_type_sort + premiumcar* financial_responsibility + carnation + sportcar*financial_responsibility + population + weather_1 + type_of_collision, family=binomial(logit))
```


```{r}
summary(model4)
```